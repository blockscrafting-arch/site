---
/**
 * Список кейсов.
 */
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import Card from '../../components/common/Card.astro';
import Badge from '../../components/common/Badge.astro';

const cases = await getCollection('cases');
const sorted = cases.sort((a, b) => {
  const dateA = a.data.date?.getTime() ?? 0;
  const dateB = b.data.date?.getTime() ?? 0;
  return dateB - dateA;
});
---

<BaseLayout
  title="Кейсы — vlad.execute(_)"
  description="Реальные проекты: автоматизация, боты, AI-агенты, n8n, Python."
>
  <div class="mx-auto max-w-5xl px-4 py-12 sm:px-6 sm:py-16">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Кейсы</h1>
    <p class="mt-2 text-gray-600 dark:text-gray-400">
      Разборы реальных проектов с результатами и цифрами.
    </p>

    {sorted.length === 0 ? (
      <p class="mt-8 text-gray-500 dark:text-gray-400">Кейсы скоро появятся.</p>
    ) : (
      <ul class="mt-8 grid gap-6 sm:grid-cols-2" role="list">
        {sorted.map((entry) => (
          <li>
            <Card href={`/cases/${entry.slug}`}>
              <h2 class="font-semibold text-gray-900 dark:text-white">{entry.data.title}</h2>
              <p class="mt-2 text-sm text-gray-600 dark:text-gray-400 line-clamp-2">
                {entry.data.description}
              </p>
              {entry.data.result && (
                <p class="mt-3 text-sm font-medium text-emerald-700 dark:text-emerald-300 line-clamp-2">
                  Результат: {entry.data.result}
                </p>
              )}
              {entry.data.metrics && entry.data.metrics.length > 0 && (
                <ul class="mt-3 flex flex-wrap gap-2" role="list">
                  {entry.data.metrics.slice(0, 3).map((m) => (
                    <li class="rounded-md bg-gray-100 dark:bg-gray-800 px-2 py-0.5 text-xs font-medium text-gray-700 dark:text-gray-300">
                      <span class="text-emerald-600 dark:text-emerald-400">{m.value}</span>
                      {' — '}
                      {m.label}
                    </li>
                  ))}
                </ul>
              )}
              {entry.data.stack && entry.data.stack.length > 0 && (
                <div class="mt-3 flex flex-wrap gap-1">
                  {entry.data.stack.map((s) => (
                    <Badge variant="emerald">{s}</Badge>
                  ))}
                </div>
              )}
            </Card>
          </li>
        ))}
      </ul>
    )}
  </div>
</BaseLayout>
