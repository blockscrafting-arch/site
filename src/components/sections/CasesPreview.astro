---
import { getCollection } from 'astro:content';
import Card from '../common/Card.astro';
import Badge from '../common/Badge.astro';
import Button from '../common/Button.astro';

const all = await getCollection('cases');
const sorted = all.sort((a, b) => {
  const dateA = a.data.date?.getTime() ?? 0;
  const dateB = b.data.date?.getTime() ?? 0;
  return dateB - dateA;
});
const cases = sorted.slice(0, 3);
---

<section class="mx-auto max-w-5xl px-4 py-16 sm:px-6 sm:py-24" aria-labelledby="cases-preview-heading">
  <h2 id="cases-preview-heading" class="text-2xl font-bold text-gray-900 dark:text-white sm:text-3xl text-center">
    Кейсы
  </h2>
  <p class="mt-4 text-center text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
    Реальные проекты с результатами и цифрами.
  </p>
  {cases.length > 0 ? (
    <ul class="mt-12 grid gap-6 sm:grid-cols-2 lg:grid-cols-3" role="list">
      {cases.map((entry) => (
        <li>
          <Card href={`/cases/${entry.slug}`}>
            <h3 class="font-semibold text-gray-900 dark:text-white">{entry.data.title}</h3>
            <p class="mt-2 text-sm text-gray-600 dark:text-gray-400 line-clamp-2">
              {entry.data.description}
            </p>
            {entry.data.stack && entry.data.stack.length > 0 && (
              <div class="mt-3 flex flex-wrap gap-1">
                {entry.data.stack.slice(0, 3).map((s) => (
                  <Badge variant="emerald">{s}</Badge>
                ))}
              </div>
            )}
          </Card>
        </li>
      ))}
    </ul>
  ) : null}
  <div class="mt-10 text-center">
    <Button href="/cases" variant="outline">Все кейсы</Button>
  </div>
</section>
